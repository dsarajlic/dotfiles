#!/usr/bin/env bash

# ~/.macos — https://mths.be/macos
# Modified by Damir Sarajlic
# Run without downloading:
# curl https://raw.githubusercontent.com/dsarajlic/dotfiles/master/.macos | bash

# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

###############################################################################
# Damirs Customizations                                                       #
###############################################################################

echo "Hello $(whoami)! Let's get you set up."

echo "mkdir -p $HOME/code"
mkdir -p "$HOME/code"

# Install Homebrew (https://brew.sh)
if [[ $(command -v brew) == "" ]]; then
    echo "Installing Hombrew"
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
    echo "Updating Homebrew"
    brew update
fi

echo "$(brew --version)"

echo "Homebrew installing..."
# coreutils: The GNU Core Utilities are the basic file, shell and text manipulation utilities of the GNU operating system
# geckodriver: driver for selenium testing with ff
# selenium-server-standalone: for selenium testing
# python@2: python2 on macosx
# imagemagick: eventually I will need this for something
# tree: really handy for listing out directories in text
# terminal-notifier: for neat looking popup
# stow: for creating symlinks in home folder
#
# Add additional libs as required
brew install coreutils geckodriver selenium-server-standalone python@2 imagemagick bash-completion watchman tree terminal-notifier stow

# yarn: without node because we'll get it later
brew install yarn --without-node

echo "Installing node"
brew install node

echo "node --version: $(node --version)"
echo "npm --version: $(npm --version)"

echo 'Please note, PWD should be /Users/<username>/Google Drive/dotfiles' /
echo 'Currently you are in '$PWD

read -p "Are you sure? " -n 1 -r
#echo    # (optional) move to a new line
if [[ $REPLY =~ ^[Yy]$ ]]
 then
    echo "Cloning dotfiles..."
    # git clone git@github.com:kentcdodds/dotfiles.git "$HOME/dotfiles"
    ln -s "$PWD/.bash_profile" "~/.bash_profile"
    ln -s "$PWD.gitignore_global" "~/.gitignore_global"
    ln -s "$PWD/.dotfiles/.my_bin" "~/.my_bin"
    ln -s "$PWD/dotfiles/.vimrc" "~/.vimrc"
    ln -s "$PWD/dotfiles/.vimrc-parts" "~/.vimrc-parts"
 fi


